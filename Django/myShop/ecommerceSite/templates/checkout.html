{% extends 'base.html' %} {% load static %} {% block content %}
<!-- <div class="row">
  <div class="col-lg-6">
    <div class="box-element" id="form-wrapper">
      <form id="form">
        <div id="user-info">
          <div class="form-field">
            <input
              required
              class="form-control"
              type="text"
              name="name"
              placeholder="Name.."
            />
          </div>
          <div class="form-field">
            <input
              required
              class="form-control"
              type="email"
              name="email"
              placeholder="Email.."
            />
          </div>
        </div>

        <div id="shipping-info">
          <hr />
          <p>Shipping Information:</p>
          <hr />
          <div class="form-field">
            <input
              required
              class="form-control"
              type="number"
              name="phone"
              placeholder="Phone No.."
            />
          </div>
          <div class="form-field">
            <input
              class="form-control"
              type="text"
              name="address"
              placeholder="Address.."
            />
          </div>
          <div class="form-field">
            <input
              class="form-control"
              type="text"
              name="city"
              placeholder="City.."
            />
          </div>
          <div class="form-field">
            <input
              class="form-control"
              type="text"
              name="state"
              placeholder="State.."
            />
          </div>
          <div class="form-field">
            <input
              class="form-control"
              type="text"
              name="zipcode"
              placeholder="Zip code.."
            />
          </div>
        </div>

        <hr id="hr-line" />
        <input
          id="form-button"
          class="btn btn-success btn-block"
          type="submit"
          value="Continue"
        />
      </form>
    </div>

    <br />
    <div class="box-element hidden" id="payment-info">
      <small>Paypal Options</small>
      <div id="paypal-button-container"></div> -->

<!-- <button id="make-payment" class="btn btn-primary">Make Payment</button> -->
<!-- </div>
  </div>

  <div class="col-lg-6">
    <div class="box-element">
      <a class="btn btn-outline-dark" href="{% url 'cart' %}"
        >&#x2190; Back to Cart</a
      >
      <hr />
      <h3>Order Summary</h3>
      <hr />

      {% for item in items %}
      <div class="cart-row">
        <div style="flex: 2">
          <img class="row-image" src="{{item.product.imageURL}}" />
        </div>
        <div style="flex: 2"><p>{{item.product.name}}</p></div>
        <div style="flex: 1">
          <p>
            <i class="fa fa-inr" aria-hidden="true"></i> {{item.product.price}}
          </p>
        </div>
        <div style="flex: 1"><p>x{{item.quantity}}</p></div>
      </div>
      {% endfor %}

      <h5>Items: {{cartItems}}</h5>
      <h5>
        Total:
        <i class="fa fa-inr" aria-hidden="true"></i> {{cartTotal}}
      </h5>
    </div>
  </div>
</div> -->

<!--  Modal -->
<div
  class="modal fade"
  id="productView"
  tabindex="-1"
  role="dialog"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body p-0">
        <div class="row align-items-stretch">
          <div class="col-lg-6 p-lg-0">
            <a
              class="product-view d-block h-100 bg-cover bg-center"
              style="background: url(img/product-5.jpg)"
              href="img/product-5.jpg"
              data-lightbox="productview"
              title="Red digital smartwatch"
            ></a
            ><a
              class="d-none"
              href="img/product-5-alt-1.jpg"
              title="Red digital smartwatch"
              data-lightbox="productview"
            ></a
            ><a
              class="d-none"
              href="img/product-5-alt-2.jpg"
              title="Red digital smartwatch"
              data-lightbox="productview"
            ></a>
          </div>
          <div class="col-lg-6">
            <button
              class="close p-4"
              type="button"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">Ã—</span>
            </button>
            <div class="p-5 my-md-4">
              <ul class="list-inline mb-2">
                <li class="list-inline-item m-0">
                  <i class="fas fa-star small text-warning"></i>
                </li>
                <li class="list-inline-item m-0">
                  <i class="fas fa-star small text-warning"></i>
                </li>
                <li class="list-inline-item m-0">
                  <i class="fas fa-star small text-warning"></i>
                </li>
                <li class="list-inline-item m-0">
                  <i class="fas fa-star small text-warning"></i>
                </li>
                <li class="list-inline-item m-0">
                  <i class="fas fa-star small text-warning"></i>
                </li>
              </ul>
              <h2 class="h4">Red digital smartwatch</h2>
              <p class="text-muted">$250</p>
              <p class="text-small mb-4">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. In ut
                ullamcorper leo, eget euismod orci. Cum sociis natoque penatibus
                et magnis dis parturient montes nascetur ridiculus mus.
                Vestibulum ultricies aliquam convallis.
              </p>
              <div class="row align-items-stretch mb-4">
                <div class="col-sm-7 pr-sm-0">
                  <div
                    class="border d-flex align-items-center justify-content-between py-1 px-3"
                  >
                    <span class="small text-uppercase text-gray mr-4 no-select"
                      >Quantity</span
                    >
                    <div class="quantity">
                      <button class="dec-btn p-0">
                        <i class="fas fa-caret-left"></i>
                      </button>
                      <input
                        class="form-control border-0 shadow-0 p-0"
                        type="text"
                        value="1"
                      />
                      <button class="inc-btn p-0">
                        <i class="fas fa-caret-right"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-sm-5 pl-sm-0">
                  <a
                    class="btn btn-dark btn-sm btn-block h-100 d-flex align-items-center justify-content-center px-0"
                    href="cart.html"
                    >Add to cart</a
                  >
                </div>
              </div>
              <a class="btn btn-link text-dark p-0" href="#"
                ><i class="far fa-heart mr-2"></i>Add to wish list</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container">
  <!-- HERO SECTION-->
  <section class="py-5 bg-light">
    <div class="container">
      <div class="row px-4 px-lg-5 py-lg-4 align-items-center">
        <div class="col-lg-6">
          <h1 class="h2 text-uppercase mb-0">Checkout</h1>
        </div>
        <div class="col-lg-6 text-lg-right">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb justify-content-lg-end mb-0 px-0">
              <li class="breadcrumb-item">
                <a href="{% url 'index' %}">Home</a>
              </li>
              <li class="breadcrumb-item">
                <a href="{% url 'cart' %}">Cart</a>
              </li>
              <li class="breadcrumb-item active" aria-current="page">
                Checkout
              </li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </section>
  <section class="py-5">
    <!-- BILLING ADDRESS-->
    <h2 class="h5 text-uppercase mb-4">Billing details</h2>
    <div class="row">
      <div class="col-lg-8">
        <form action="#">
          <div class="row">
            <div class="col-lg-6 form-group">
              <label class="text-small text-uppercase" for="firstName"
                >First name</label
              >
              <input
                class="form-control form-control-lg"
                id="firstName"
                type="text"
                placeholder="Enter your first name"
              />
            </div>
            <div class="col-lg-6 form-group">
              <label class="text-small text-uppercase" for="lastName"
                >Last name</label
              >
              <input
                class="form-control form-control-lg"
                id="lastName"
                type="text"
                placeholder="Enter your last name"
              />
            </div>
            <div class="col-lg-6 form-group">
              <label class="text-small text-uppercase" for="email"
                >Email address</label
              >
              <input
                class="form-control form-control-lg"
                id="email"
                type="email"
                placeholder="e.g. Jason@example.com"
              />
            </div>
            <div class="col-lg-6 form-group">
              <label class="text-small text-uppercase" for="phone"
                >Phone number</label
              >
              <input
                class="form-control form-control-lg"
                id="phone"
                type="tel"
                placeholder="e.g. +02 245354745"
              />
            </div>
            <div class="col-lg-6 form-group">
              <label class="text-small text-uppercase" for="company"
                >Company name (optional)</label
              >
              <input
                class="form-control form-control-lg"
                id="company"
                type="text"
                placeholder="Your company name"
              />
            </div>
            <div class="col-lg-6 form-group">
              <label class="text-small text-uppercase" for="country"
                >Country</label
              >
              <select
                class="selectpicker country"
                id="country"
                data-width="fit"
                data-style="form-control form-control-lg"
                data-title="Select your country"
              ></select>
            </div>
            <div class="col-lg-12 form-group">
              <label class="text-small text-uppercase" for="address"
                >Address line 1</label
              >
              <input
                class="form-control form-control-lg"
                id="address"
                type="text"
                placeholder="House number and street name"
              />
            </div>
            <div class="col-lg-12 form-group">
              <label class="text-small text-uppercase" for="address"
                >Address line 2</label
              >
              <input
                class="form-control form-control-lg"
                id="addressalt"
                type="text"
                placeholder="Apartment, Suite, Unit, etc (optional)"
              />
            </div>
            <div class="col-lg-6 form-group">
              <label class="text-small text-uppercase" for="city"
                >Town/City</label
              >
              <input
                class="form-control form-control-lg"
                id="city"
                type="text"
              />
            </div>
            <div class="col-lg-6 form-group">
              <label class="text-small text-uppercase" for="state"
                >State/County</label
              >
              <input
                class="form-control form-control-lg"
                id="state"
                type="text"
              />
            </div>
            <div class="col-lg-6 form-group">
              <div class="custom-control custom-checkbox">
                <input
                  class="custom-control-input"
                  id="alternateAddressCheckbox"
                  type="checkbox"
                />
                <label
                  class="custom-control-label text-small"
                  for="alternateAddressCheckbox"
                  >Alternate billing address</label
                >
              </div>
            </div>
            <div class="col-lg-12">
              <div class="row d-none" id="alternateAddress">
                <div class="col-12 mt-4">
                  <h2 class="h4 text-uppercase mb-4">
                    Alternative billing details
                  </h2>
                </div>
                <div class="col-lg-6 form-group">
                  <label class="text-small text-uppercase" for="firstName2"
                    >First name</label
                  >
                  <input
                    class="form-control form-control-lg"
                    id="firstName2"
                    type="text"
                    placeholder="Enter your first name"
                  />
                </div>
                <div class="col-lg-6 form-group">
                  <label class="text-small text-uppercase" for="lastName2"
                    >Last name</label
                  >
                  <input
                    class="form-control form-control-lg"
                    id="lastName2"
                    type="text"
                    placeholder="Enter your last name"
                  />
                </div>
                <div class="col-lg-6 form-group">
                  <label class="text-small text-uppercase" for="email2"
                    >Email address</label
                  >
                  <input
                    class="form-control form-control-lg"
                    id="email2"
                    type="email"
                    placeholder="e.g. Jason@example.com"
                  />
                </div>
                <div class="col-lg-6 form-group">
                  <label class="text-small text-uppercase" for="phone2"
                    >Phone number</label
                  >
                  <input
                    class="form-control form-control-lg"
                    id="phone2"
                    type="tel"
                    placeholder="e.g. +02 245354745"
                  />
                </div>
                <div class="col-lg-6 form-group">
                  <label class="text-small text-uppercase" for="company2"
                    >Company name (optional)</label
                  >
                  <input
                    class="form-control form-control-lg"
                    id="company2"
                    type="text"
                    placeholder="Your company name"
                  />
                </div>
                <div class="col-lg-6 form-group">
                  <label class="text-small text-uppercase" for="country2"
                    >Country</label
                  >
                  <select
                    class="selectpicker country"
                    id="country2"
                    data-width="fit"
                    data-style="form-control form-control-lg"
                    data-title="Select your country"
                  ></select>
                </div>
                <div class="col-lg-12 form-group">
                  <label class="text-small text-uppercase" for="address2"
                    >Address line 1</label
                  >
                  <input
                    class="form-control form-control-lg"
                    id="address2"
                    type="text"
                    placeholder="House number and street name"
                  />
                </div>
                <div class="col-lg-12 form-group">
                  <label class="text-small text-uppercase" for="address2"
                    >Address line 2</label
                  >
                  <input
                    class="form-control form-control-lg"
                    id="addressalt2"
                    type="text"
                    placeholder="Apartment, Suite, Unit, etc (optional)"
                  />
                </div>
                <div class="col-lg-6 form-group">
                  <label class="text-small text-uppercase" for="city3"
                    >Town/City</label
                  >
                  <input
                    class="form-control form-control-lg"
                    id="city3"
                    type="text"
                  />
                </div>
                <div class="col-lg-6 form-group">
                  <label class="text-small text-uppercase" for="state4"
                    >State/County</label
                  >
                  <input
                    class="form-control form-control-lg"
                    id="state4"
                    type="text"
                  />
                </div>
              </div>
            </div>
            <div class="col-lg-12 form-group">
              <button class="btn btn-dark" type="submit">Place order</button>
            </div>
          </div>
        </form>
      </div>
      <!-- ORDER SUMMARY-->
      <div class="col-lg-4">
        <div class="card border-0 rounded-0 p-lg-4 bg-light">
          <div class="card-body">
            <h5 class="text-uppercase mb-4">
              YOUR ORDER <span class="text-lowercase">(x{{cartItems}})</span>
            </h5>
            <ul class="list-unstyled mb-0">
              {% for item in items %}
              <li class="d-flex align-items-center justify-content-between">
                <strong class="small"
                  >{{item.product.name}} ({{item.quantity}})</strong
                ><span class="text-muted small"
                  ><i class="fa fa-inr" aria-hidden="true"></i>
                  {{item.product.price}}*{{item.quantity}}</span
                >
              </li>
              <li class="border-bottom my-2"></li>
              {% endfor %}

              <li class="d-flex align-items-center justify-content-between">
                <strong class="text-uppercase small font-weight-bold"
                  >Total</strong
                ><span
                  ><i class="fa fa-inr" aria-hidden="true"></i>
                  {{cartTotal}}</span
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

{% endblock content %} {% block javascript %}

<script src="https://www.paypal.com/sdk/js?client-id=AfhSulu4Y3Xl1r83tkETB0ijs0C4HksblKgPuscTSlz8Gu2XVOViD8ni884xlOGkq1s9fStOdg4456ip&currency=USD"></script>

<script>
  // Render the PayPal button into #paypal-button-container
  paypal
    .Buttons({
      // Set up the transaction
      createOrder: function (data, actions) {
        return actions.order.create({
          purchase_units: [
            {
              amount: {
                value: "5",
              },
            },
          ],
        });
      },

      // Finalize the transaction
      onApprove: function (data, actions) {
        return actions.order.capture().then(function (details) {
          // Show a success message to the buyer
          alert(
            "Transaction completed by " + details.payer.name.given_name + "!"
          );
        });
      },
    })
    .render("#paypal-button-container");
</script>

<script type="text/javascript">
  var total = "{{order.get_cart_total}}";

  var form = document.getElementById("form");

  if (user !== "AnonymousUser") {
    form.name.value = "{{request.user.get_full_name}}";
    form.email.value = "{{request.user.email}}";
    form.name.readOnly = true;
    form.email.readOnly = true;
  }

  form.addEventListener("submit", function (e) {
    e.preventDefault();
    document.getElementById("form-button").classList.add("hidden");
    document.getElementById("hr-line").classList.add("hidden");
    document.getElementById("payment-info").classList.remove("hidden");
  });

  /*document
      .getElementById("make-payment")
      .addEventListener("click", function (e) {
        submitFormData();
      });*/

  function submitFormData() {
    console.log("Payment has been Initiated!!");

    var userFormData = {
      name: null,
      email: null,
      total: total,
    };

    var shippingInfo = {
      address: null,
      state: null,
      city: null,
      zipcode: null,
    };

    shippingInfo.address = form.address.value;
    shippingInfo.state = form.state.value;
    shippingInfo.city = form.city.value;
    shippingInfo.zipcode = form.zipcode.value;

    if (user == "AnonymousUser") {
      userFormData.name = form.name.value;
      userFormData.email = form.email.value;
    }

    var url = "/store/process_order/";

    fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": csrftoken,
      },
      body: JSON.stringify({ form: userFormData, shipping: shippingInfo }),
    })
      .then((response) => {
        return response.json();
      })
      .then((data) => {
        console.log("Success:", data);
        console.log("Transaction Completed!!");

        cart = {};
        document.cookie = "cart=" + JSON.stringify(cart) + ";domain=;path=/";

        window.location.href = "{% url 'store' %}";
      });
  }
</script>
{% endblock javascript %}
